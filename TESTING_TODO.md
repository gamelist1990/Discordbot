# Todo Management System - Testing Guide

## システム概要

このTodo管理システムは、Discordと統合されたWebベースのタスク管理ツールです。ユーザーはDiscordサーバー内から `/todo` コマンドを実行してアクセスできます。

## テストの前提条件

1. **サーバーが起動していること**
   ```bash
   bun run dev
   # または
   npm run dev
   ```

2. **Discord Botが起動していること**
   - Bot tokenが設定されている
   - `/todo` コマンドが登録されている

3. **OAuth2の設定が完了していること**
   - `config.json` に Discord Application ID と Secret が設定されている
   - Redirect URIが正しく設定されている

## テストシナリオ

### 1. 認証フロー

#### 1.1 Discord OAuth2ログイン

1. Discordサーバーで `/todo` コマンドを実行
2. 表示されたボタンをクリック
3. ブラウザが開き、`http://localhost:3000/todo/{guildId}` にアクセス
4. ログインページが表示される
5. 「Discord でログイン」ボタンをクリック
6. Discordの認証画面が表示される
7. 「認証」をクリック
8. Todoダッシュボードにリダイレクトされる

**期待結果:**
- ✅ スムーズにログインが完了する
- ✅ ダッシュボードに自分のアバター、username、userIdが表示される
- ✅ Cookie (`sessionId`) がセットされる

#### 1.2 セッション維持

1. ログイン後、ブラウザをリフレッシュ
2. ログイン状態が維持されていることを確認

**期待結果:**
- ✅ ログインページに戻らない
- ✅ ダッシュボードが表示される

#### 1.3 ログアウト

1. 右上の「ログアウト」ボタンをクリック
2. トップページにリダイレクトされる
3. 再度 `/todo/{guildId}` にアクセス
4. ログインページが表示される

**期待結果:**
- ✅ ログアウト後はログインが必要
- ✅ Cookie (`sessionId`) が削除される

---

### 2. Todoセッション管理

#### 2.1 セッション作成（1個目）

1. ダッシュボードで「新規セッション作成」ボタンをクリック
2. モーダルが開く
3. セッション名に「テストプロジェクト1」と入力
4. 「作成」ボタンをクリック

**期待結果:**
- ✅ セッションが作成される
- ✅ ダッシュボードに新しいカードが表示される
- ✅ カードに「オーナー」バッジが表示される
- ✅ 「新規セッション作成 (1/3)」と表示される

#### 2.2 セッション作成（2個目、3個目）

1. 同様に「テストプロジェクト2」「テストプロジェクト3」を作成

**期待結果:**
- ✅ 合計3個のセッションが作成される
- ✅ 「新規セッション作成 (3/3)」と表示される

#### 2.3 セッション作成制限

1. 「新規セッション作成」ボタンが表示されなくなる
2. 代わりに「最大3個までセッションを作成できます（現在: 3/3）」と表示される

**期待結果:**
- ✅ 4個目は作成できない
- ✅ 制限メッセージが表示される

#### 2.4 セッションを開く

1. 「テストプロジェクト1」のカードで「開く」ボタンをクリック
2. セッション詳細ページに移動

**期待結果:**
- ✅ `/todo/{guildId}/session/{sessionId}` にアクセスする
- ✅ セッション名が表示される
- ✅ 「オーナー」バッジが表示される
- ✅ 「共有」「削除」ボタンが表示される

---

### 3. Todo項目の操作

#### 3.1 Todo追加

1. セッション詳細ページで入力欄に「タスク1」と入力
2. Enterキーを押すか、「+」ボタンをクリック

**期待結果:**
- ✅ Todoが追加される
- ✅ リストに表示される
- ✅ 優先度が「中」で表示される

#### 3.2 複数Todo追加

1. 「タスク2」「タスク3」を追加

**期待結果:**
- ✅ 3個のTodoが表示される

#### 3.3 Todo完了

1. 「タスク1」のチェックボックスをクリック

**期待結果:**
- ✅ チェックが入る
- ✅ テキストに取り消し線が付く
- ✅ カード全体が薄くなる
- ✅ 「完了 (1)」カウントが更新される

#### 3.4 フィルター

1. 「未完了」ボタンをクリック
2. 完了したTodoが非表示になる
3. 「完了」ボタンをクリック
4. 完了したTodoのみ表示される
5. 「全て」ボタンをクリック
6. 全てのTodoが表示される

**期待結果:**
- ✅ フィルターが正しく動作する
- ✅ カウント数が正確

#### 3.5 Todo削除

1. 「タスク1」の削除ボタン（ゴミ箱アイコン）をクリック

**期待結果:**
- ✅ Todoが削除される
- ✅ リストから消える
- ✅ カウントが更新される

---

### 4. 共有機能

#### 4.1 メンバー追加（別ユーザーで）

**準備:**
- 別のDiscordアカウントでログイン
- そのユーザーのIDをメモ

**手順:**
1. セッション詳細ページで「共有」ボタンをクリック
2. 共有モーダルが開く
3. ユーザーID入力欄に別ユーザーのIDを入力
4. 役割を「閲覧者」に設定
5. 「追加」ボタンをクリック

**期待結果:**
- ✅ 「閲覧者」リストにユーザーIDが追加される

#### 4.2 閲覧者の確認（別ユーザーで）

1. 別ユーザーでログイン
2. ダッシュボードにアクセス
3. 共有されたセッションが表示される
4. 「閲覧者」バッジが表示される
5. セッションを開く
6. Todoは見えるが、入力欄や削除ボタンは表示されない

**期待結果:**
- ✅ 閲覧のみ可能
- ✅ 編集・削除ボタンが disabled または非表示
- ✅ 入力欄が表示されない

#### 4.3 エディターに変更

1. オーナーアカウントで共有モーダルを開く
2. 閲覧者リストから削除
3. ユーザーIDを再度入力
4. 役割を「編集者」に設定
5. 「追加」ボタンをクリック

**期待結果:**
- ✅ 「編集者」リストに移動
- ✅ 別ユーザーでリロードすると「編集者」バッジが表示される

#### 4.4 編集者の確認（別ユーザーで）

1. 別ユーザーでセッションを開く
2. Todoの追加・完了・削除ができる
3. 「共有」「削除」ボタンは表示されない

**期待結果:**
- ✅ Todoの編集が可能
- ✅ セッション自体の削除や共有設定は不可

#### 4.5 メンバー削除

1. オーナーアカウントで共有モーダルを開く
2. 編集者リストの削除ボタンをクリック

**期待結果:**
- ✅ メンバーが削除される
- ✅ 別ユーザーではセッションが表示されなくなる

---

### 5. お気に入り機能

#### 5.1 お気に入り追加

1. ダッシュボードでセッションカードの星アイコンをクリック

**期待結果:**
- ✅ 星が塗りつぶされる（黄色）
- ✅ 「お気に入り」フィルターで表示される

#### 5.2 お気に入り削除

1. もう一度星アイコンをクリック

**期待結果:**
- ✅ 星が枠線のみに戻る
- ✅ 「お気に入り」フィルターで非表示になる

---

### 6. フィルター機能

#### 6.1 「所有」フィルター

1. ダッシュボードで「所有」ボタンをクリック

**期待結果:**
- ✅ 自分が作成したセッションのみ表示される
- ✅ 共有されたセッションは非表示

#### 6.2 「共有」フィルター

1. 「共有」ボタンをクリック

**期待結果:**
- ✅ 他人から共有されたセッションのみ表示される
- ✅ 自分が作成したセッションは非表示

#### 6.3 「全て」フィルター

1. 「全て」ボタンをクリック

**期待結果:**
- ✅ 所有・共有すべてのセッションが表示される

---

### 7. セッション削除

#### 7.1 オーナーによる削除

1. 自分が作成したセッションを開く
2. 「削除」ボタンをクリック
3. 確認ダイアログで「OK」をクリック

**期待結果:**
- ✅ セッションが削除される
- ✅ ダッシュボードにリダイレクトされる
- ✅ カードが消える
- ✅ 「新規セッション作成 (2/3)」に戻る

#### 7.2 非オーナーは削除不可

1. 別ユーザーでエディターとして共有されたセッションを開く
2. 「削除」ボタンが表示されないことを確認

**期待結果:**
- ✅ 削除ボタンが表示されない

---

### 8. エラーハンドリング

#### 8.1 空のセッション名

1. 「新規セッション作成」をクリック
2. 何も入力せずに「作成」ボタンをクリック

**期待結果:**
- ✅ ボタンが disabled で押せない

#### 8.2 長すぎるセッション名

1. 101文字以上入力しようとする

**期待結果:**
- ✅ 100文字で入力が制限される
- ✅ 「100/100」と表示される

#### 8.3 空のTodo

1. セッション詳細で何も入力せずにEnterキーを押す

**期待結果:**
- ✅ Todoが追加されない

#### 8.4 未認証アクセス

1. ログアウト状態で `/todo/{guildId}` に直接アクセス

**期待結果:**
- ✅ ログインページが表示される
- ✅ ダッシュボードは表示されない

---

### 9. UI/UX

#### 9.1 レスポンシブデザイン

1. ブラウザのウィンドウサイズを変更
2. スマートフォンサイズ（375px）で確認

**期待結果:**
- ✅ レイアウトが崩れない
- ✅ ボタンやカードが適切に配置される

#### 9.2 ローディング表示

1. ページ読み込み時にスピナーが表示される

**期待結果:**
- ✅ 読み込み中はスピナーが表示される
- ✅ 読み込み完了後はコンテンツが表示される

#### 9.3 エラーメッセージ

1. ネットワークエラーが発生した場合のメッセージ表示

**期待結果:**
- ✅ 赤いエラーバーが表示される
- ✅ エラーアイコンとメッセージが表示される

---

## パフォーマンステスト

### 1. 大量のTodoアイテム

1. 1つのセッションに50個以上のTodoを追加
2. 完了/未完了を切り替え
3. フィルターを切り替え

**期待結果:**
- ✅ 動作が遅くならない
- ✅ UIが応答性を保つ

### 2. 複数ユーザーの同時アクセス

1. 3人以上のユーザーが同時にログイン
2. それぞれがセッションを作成・編集

**期待結果:**
- ✅ サーバーが正常に応答する
- ✅ データの整合性が保たれる

---

## セキュリティテスト

### 1. 認証なしアクセス

1. Cookie を削除
2. `/api/todos/sessions` に直接アクセス

**期待結果:**
- ✅ 401 または 404 エラーが返る

### 2. 他人のセッションへのアクセス

1. 他人のセッションIDを URL に直接入力
2. アクセスを試みる

**期待結果:**
- ✅ 403 エラーが返る（アクセス拒否）

### 3. XSS対策

1. セッション名に `<script>alert('XSS')</script>` を入力

**期待結果:**
- ✅ スクリプトが実行されない
- ✅ テキストとして表示される

---

## まとめ

このテストガイドに従って、Todoシステムの全機能を検証してください。全てのテストが成功すれば、システムは本番環境で使用可能です。

問題が見つかった場合は、以下の情報を含めて報告してください：
- テストシナリオ番号
- 期待される動作
- 実際の動作
- ブラウザの開発者ツールのコンソールログ
- サーバーログ
