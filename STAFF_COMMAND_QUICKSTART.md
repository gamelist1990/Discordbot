# Staff Command Quick Start Guide

## 概要

`/staff` コマンドはスタッフ向けの管理機能を提供するモジュール式コマンドです。

## 使い方

### 1. ヘルプの表示

```
/staff help
```

または、特定のページを表示：

```
/staff help page:2
```

**結果:**
- スタッフコマンドの一覧が表示されます
- 各コマンドの使用方法と例が確認できます
- ページナビゲーションで他のページへ移動できます

---

### 2. プライベートチャットの作成

```
/staff privatechat action:create user:@ユーザー名
```

**実行内容:**
1. 「プライベートチャット」カテゴリが自動作成されます（初回のみ）
2. `private-ユーザー名` という名前のチャンネルが作成されます
3. 指定したユーザーとあなただけがチャンネルを見られます
4. ウェルカムメッセージが自動送信されます

**権限設定:**
- サーバー全体: チャンネルが見えない
- 対象ユーザー: 表示・送信・履歴閲覧が可能
- あなた（スタッフ）: 上記 + メッセージ管理が可能

---

### 3. プライベートチャット一覧の表示

```
/staff privatechat action:list
```

**表示される情報:**
- チャンネル名とリンク
- 対象ユーザー
- 担当スタッフ
- 作成日時（相対表示）

最大10件まで表示されます。

---

### 4. プライベートチャットの削除

```
/staff privatechat action:delete chat_id:チャンネルID
```

**注意:**
- チャンネルIDは一覧表示で確認できます
- チャンネルとデータベースエントリの両方が削除されます
- この操作は取り消せません

---

### 5. Web UI での管理

```
/staff privatechat action:manage
```

**機能:**
- ブラウザからプライベートチャットを管理できます
- 一覧表示・作成・削除がより視覚的に行えます
- 生成されたURLは30分間有効です

**セキュリティ:**
- URLは他の人と共有しないでください
- 30分後に自動的に無効になります

---

## 実例

### ケース1: 新しいユーザーとのプライベート相談

1. ユーザーから相談の依頼を受ける
2. `/staff privatechat action:create user:@相談者` を実行
3. 作成されたチャンネルで1対1で対応
4. 相談が終わったら `/staff privatechat action:delete chat_id:チャンネルID` で削除

### ケース2: 複数のプライベートチャットを管理

1. `/staff privatechat action:list` で現在のチャット一覧を確認
2. 古いチャットや終了したチャットを特定
3. 各チャットIDをコピーして削除コマンドを実行

### ケース3: ブラウザから管理

1. `/staff privatechat action:manage` を実行
2. 表示されたURLをブラウザで開く
3. Web UIで一覧を確認し、必要に応じて作成・削除

---

## トラブルシューティング

### Q: コマンドが表示されない

**A:** Bot を再起動するか、以下を確認してください：
- あなたが「サーバー管理」権限を持っているか
- コマンドがサーバーにデプロイされているか

### Q: チャンネルを作成できない

**A:** 以下を確認してください：
- Bot に「チャンネルの管理」権限があるか
- カテゴリに空きがあるか（上限50チャンネル）

### Q: Web UI が開けない

**A:** 以下を確認してください：
- 設定サーバーが起動しているか
- ポート3000が使用可能か
- URLの有効期限が切れていないか（30分）

### Q: 削除したチャンネルがデータベースに残っている

**A:** 手動でチャンネルを削除した場合、以下を実行してください：
1. `/staff privatechat action:list` で確認
2. 該当するチャットIDで削除コマンドを実行

---

## 権限について

### 必要な権限

- **ユーザー:** サーバー管理（ManageGuild）権限が必要
- **Bot:** チャンネルの管理権限が必要

### サーバー管理権限の確認方法

1. サーバー設定 → メンバー → あなたのユーザーを選択
2. 権限タブで「サーバー管理」にチェックが入っているか確認

---

## データの保存場所

プライベートチャット情報は以下に保存されます：

```
Data/staff_private_chats.json
```

**形式:**
```json
[
  {
    "chatId": "1234567890",
    "channelId": "1234567890",
    "userId": "9876543210",
    "staffId": "5555555555",
    "guildId": "1111111111",
    "createdAt": 1234567890000
  }
]
```

---

## ベストプラクティス

### ✅ 推奨

- 相談が終わったらすぐにチャットを削除
- 定期的に一覧を確認して古いチャットを整理
- Web UI を使って効率的に管理
- チャット内でメモを残す（スタッフ用）

### ❌ 非推奨

- チャンネルを手動で削除（データベースに残ります）
- 同じユーザーと複数のチャットを作成（混乱の元）
- トークン付きURLの共有（セキュリティリスク）
- 放置されたチャットの長期保持（リソースの無駄）

---

## 今後追加される予定の機能

- チャット通知システム
- 他のスタッフへの引き継ぎ機能
- チャット統計の表示
- 自動アーカイブ機能
- よくある質問のテンプレート
- ユーザー評価システム

---

## サポート

問題が発生した場合や機能の要望がある場合は、開発者に連絡してください。

**ドキュメント:**
- 詳細実装ガイド: `STAFF_COMMAND_IMPLEMENTATION.md`
- モジュールREADME: `src/commands/staff/README.md`
